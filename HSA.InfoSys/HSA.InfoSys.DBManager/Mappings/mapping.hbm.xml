<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                    assembly="HSA.InfoSys.DBManager"
                    namespace="HSA.InfoSys.Common.DBManager.Data">

  <class name="Entity" table="Entity">
    <id name="EntityId">
      <generator class="guid.comb" />
    </id>

    <!-- Component -->
    <joined-subclass name="Component" table="Component">
      <key column="ComponentGUID" />

      <many-to-one class="Result" name="Result" column="ResultGUID" cascade="save-update" />

      <property name="Category" type="string" length ="100" not-null="true" />
      <property name="Name" type="string" length ="100" not-null="true" />
    </joined-subclass>

    <!-- Result -->
    <joined-subclass name="Result" table="Result">
      <key column="ResultGUID" />

      <property name="Data" type="string" >
        <column name="Data" sql-type="text" not-null="true" />
      </property>
      <property name="TimeStamp" type="timestamp" not-null="true"/>
    </joined-subclass>

    <!-- Scheduler -->
    <joined-subclass name="Scheduler" table="Scheduler">
      <key column="SchedulerGUID" />

      <property name="Days" type="int" column="Days" not-null="true"/>
      <property name="Hours" type="int" column="Hours" not-null="true"/>
      <property name="TimeStamp" type="timestamp" column="Timestamp" not-null="true"/>
    </joined-subclass>

    <!-- SystemService -->
    <joined-subclass name="SystemService" table="SystemService">
      <key column="SystemServiceGUID" />

      <many-to-one name="Component" class="Component" column="ComponentGUID" cascade="save-update"  />
      <many-to-one name="SystemConfig" class="SystemConfig" column="SystemconfigGUID" cascade="save-update" />

      <property name="UserId" type="int" column="UserId" length="10" not-null="true"/>
      <property name="TimeStamp" type="timestamp" column="Timestamp" not-null="true"/>

    </joined-subclass>

    <!-- SystemConfig -->
    <joined-subclass name="SystemConfig" table="SystemConfig">
      <key column="SystemConfigGUID" />

      <many-to-one name="Scheduler" class="Scheduler" column="SchedulerGUID" cascade="save-update" />

      <property name="Email" type="string">
        <column name="Email" sql-type="text" not-null="false"/>
      </property>

      <property name="URL" type="string" >
        <column name="URL" length ="2043" not-null="true" />
      </property>

      <property name="URLActive" type="bool" column="URLActive" not-null="true"/>
      <property name="EmailNotification" type="bool" column="EmailNotification" not-null="true"/>
      <property name="SchedulerActive" type="bool" column="SchedulerActive" not-null="true"/>
    </joined-subclass>

    <!-- Issue -->
    <joined-subclass name ="Issue" table="Issue">
      <key column="IssueGUID" />

      <many-to-one name="Component" class="Component" column="ComponentGUID" cascade="save-update" />
      <many-to-one name="Source" class="Source" column="SourceGUID" cascade="save-update" />

      <property name="Text" type="string">
        <column name="text" sql-type="mediumtext" length="16777215" not-null="false"/>
      </property>

      <property name="Title" type="string" length ="40" not-null="true"/>
      <property name="ThreatLevel" type="int" length ="11" not-null="true"/>
      <property name="Date" type="date" not-null="true"/>
    </joined-subclass>

    <!-- Source -->
    <joined-subclass name="Source" table="Source">
      <key column="SourceGUID" />

      <property name="URL" type="string" >
        <column name="URL" length ="2043" not-null="true" />
      </property>
    </joined-subclass>
  </class>
</hibernate-mapping>
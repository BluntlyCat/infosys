<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>HSA.InfoSys: C:/Users/michael/Development/HSA.InfoSys/3rdparty/nhibernate-core/src/NHibernate/Collection/PersistentBag.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="hsasec.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">HSA.InfoSys
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Crawls webpages for security issues, collect this information and views the results for specified components.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_persistent_bag_8cs_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PersistentBag.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> System.Collections;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Data;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> System.Diagnostics;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> NHibernate.DebugHelpers;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> NHibernate.Engine;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> NHibernate.Loader;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> NHibernate.Persister.Collection;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> NHibernate.Type;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> NHibernate.Util;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">namespace </span>NHibernate.Collection</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;{</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    [Serializable]</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    [DebuggerTypeProxy(typeof (<a class="code" href="class_n_hibernate_1_1_debug_helpers_1_1_collection_proxy.html">CollectionProxy</a>))]</div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html">   23</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a> : <a class="code" href="class_n_hibernate_1_1_collection_1_1_abstract_persistent_collection.html" title="Base class for implementing IPersistentCollection. ">AbstractPersistentCollection</a>, IList</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keyword">protected</span> IList bag;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a>() {} <span class="comment">// needed for serialization</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a>(<a class="code" href="interface_n_hibernate_1_1_engine_1_1_i_session_implementor.html" title="Defines the internal contract between the Session and other parts of NHibernate such as implementors ...">ISessionImplementor</a> session) : base(session) {}</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a>(<a class="code" href="interface_n_hibernate_1_1_engine_1_1_i_session_implementor.html" title="Defines the internal contract between the Session and other parts of NHibernate such as implementors ...">ISessionImplementor</a> session, ICollection coll) : base(session)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            bag = coll as IList;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            <span class="keywordflow">if</span> (bag == null)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                bag = <span class="keyword">new</span> ArrayList(coll);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            SetInitialized();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            IsDirectlyAccessible = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> RowUpdatePossible</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#adfea5df3e63722824a0042ad98e7816e">   49</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#adfea5df3e63722824a0042ad98e7816e" title="Is this the wrapper for the given underlying collection instance? ">IsWrapper</a>(<span class="keywordtype">object</span> collection)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            <span class="keywordflow">return</span> bag == collection;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> Empty</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> bag.Count == 0; }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a315908e917195190573b024b974e9f29">   59</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> IEnumerable <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a315908e917195190573b024b974e9f29" title="Iterate all collection entries, during update of the database ">Entries</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="keywordflow">return</span> bag;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#aaacfd00655364c5c838905d476a5d914">   64</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#aaacfd00655364c5c838905d476a5d914" title="Reads the row from the IDataReader. ">ReadFrom</a>(IDataReader reader, <a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> role, <a class="code" href="interface_n_hibernate_1_1_loader_1_1_i_collection_aliases.html" title="Type definition of CollectionAliases. ">ICollectionAliases</a> descriptor,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                        <span class="keywordtype">object</span> owner)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="comment">// note that if we load this collection from a cartesian product</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="comment">// the multiplicity would be broken ... so use an idbag instead</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordtype">object</span> element = role.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a1f37a4f8da2b1bb9ed1044e18265da11" title="Read the element from a row of the IDataReader ">ReadElement</a>(reader, owner, descriptor.<a class="code" href="interface_n_hibernate_1_1_loader_1_1_i_collection_aliases.html#a6e98677b01e6270ada73e4dd8e9e842a" title="Returns the suffixed result-set column-aliases for the columns making up the collection&#39;s elements...">SuffixedElementAliases</a>, Session);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="comment">// NH Different behavior : we don&#39;t check for null</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="comment">// The NH-750 test show how checking for null we are ignoring the not-found tag and</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="comment">// the DB may have some records ignored by NH. This issue may need some more deep consideration.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="comment">//if (element != null)</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                bag.Add(element);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">return</span> element;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a626f6dae39e7609def9a4b51bc9f8b66">   78</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a626f6dae39e7609def9a4b51bc9f8b66" title="Called before any elements are read into the collection, allowing appropriate initializations to occu...">BeforeInitialize</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister, <span class="keywordtype">int</span> anticipatedSize)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            bag = (IList) persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a728fb7abf627d305a02b2342ab99de50" title="Get the associated IType ">CollectionType</a>.<a class="code" href="class_n_hibernate_1_1_type_1_1_collection_type.html#a9783a5d540cc38c557f5d8f5e5e4cefb" title="Instantiate an uninitialized collection wrapper or holder. Callers MUST add the holder to the persist...">Instantiate</a>(anticipatedSize);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a35551ff0c4b16b4fe7db34027fdf436e">   83</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a35551ff0c4b16b4fe7db34027fdf436e" title="Does the current state exactly match the snapshot? ">EqualsSnapshot</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html">IType</a> elementType = persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a33cdc395b06756989d606d5d7f5cf858" title="Get the &quot;element&quot; type ">ElementType</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <a class="code" href="namespace_n_hibernate.html#a3b5a7882bfc34e812d919e4a806a9438" title="Defines the representation modes available for entities. ">EntityMode</a> entityMode = Session.EntityMode;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            IList sn = (IList) GetSnapshot();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">if</span> (sn.Count != bag.Count)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> elt <span class="keywordflow">in</span> bag)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keywordflow">if</span> (CountOccurrences(elt, bag, elementType, entityMode) != CountOccurrences(elt, sn, elementType, entityMode))</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a98e81feec9a6236cc86954e59fb5f43c">  105</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a98e81feec9a6236cc86954e59fb5f43c" title="Is the snapshot empty?">IsSnapshotEmpty</a>(<span class="keywordtype">object</span> snapshot)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">return</span> ((ICollection) snapshot).Count == 0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">int</span> CountOccurrences(<span class="keywordtype">object</span> element, IList list, <a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html">IType</a> elementType, <a class="code" href="namespace_n_hibernate.html#a3b5a7882bfc34e812d919e4a806a9438" title="Defines the representation modes available for entities. ">EntityMode</a> entityMode)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordtype">int</span> result = 0;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> obj <span class="keywordflow">in</span> list)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="keywordflow">if</span> (elementType.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html#a72caf67ec4d053311e6a47d5ec4b1c06" title="Compare two instances of the class mapped by this type for persistence &quot;equality&quot; - equality of persi...">IsSame</a>(element, obj, entityMode))</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    result++;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#aabc49e138a5dd1894982802948027adb">  135</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#aabc49e138a5dd1894982802948027adb" title="Return a new snapshot of the current state of the collection ">GetSnapshot</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <a class="code" href="namespace_n_hibernate.html#a3b5a7882bfc34e812d919e4a806a9438" title="Defines the representation modes available for entities. ">EntityMode</a> entityMode = Session.EntityMode;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            List&lt;object&gt; clonedList = <span class="keyword">new</span> List&lt;object&gt;(bag.Count);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> current <span class="keywordflow">in</span> bag)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                clonedList.Add(persister.ElementType.DeepCopy(current, entityMode, persister.Factory));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">return</span> clonedList;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a4155d486da53eed1511df740246770c8">  146</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> ICollection <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a4155d486da53eed1511df740246770c8" title="Get all &quot;orphaned&quot; elements ">GetOrphans</a>(<span class="keywordtype">object</span> snapshot, <span class="keywordtype">string</span> entityName)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            IList sn = (IList) snapshot;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">return</span> GetOrphans(sn, bag, entityName, Session);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#ab4cc3ace18ef303e085401cb545d8c90">  152</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#ab4cc3ace18ef303e085401cb545d8c90" title="Disassemble the collection, ready for the cache ">Disassemble</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordtype">int</span> length = bag.Count;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordtype">object</span>[] result = <span class="keyword">new</span> <span class="keywordtype">object</span>[length];</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; length; i++)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                result[i] = persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a33cdc395b06756989d606d5d7f5cf858" title="Get the &quot;element&quot; type ">ElementType</a>.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_cache_assembler.html#a07174a85e51386ea92c9afc74295fe4f" title="Return a cacheable &quot;disassembled&quot; representation of the object.">Disassemble</a>(bag[i], Session, null);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#ab5e9537678d7734eda548cac450a0080">  171</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#ab5e9537678d7734eda548cac450a0080" title="Initializes this PersistentBag from the cached values. ">InitializeFromCache</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister, <span class="keywordtype">object</span> disassembled, <span class="keywordtype">object</span> owner)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordtype">object</span>[] array = (<span class="keywordtype">object</span>[]) disassembled;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordtype">int</span> size = array.Length;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            BeforeInitialize(persister, size);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordtype">object</span> element = persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a33cdc395b06756989d606d5d7f5cf858" title="Get the &quot;element&quot; type ">ElementType</a>.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_cache_assembler.html#ad67b071c42556a7427157f35738aa80f" title="Reconstruct the object from its cached &quot;disassembled&quot; state.">Assemble</a>(array[i], Session, owner);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <span class="keywordflow">if</span> (element != null)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    bag.Add(element);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a283568c024f198cfc743c367f1bdb582">  197</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a283568c024f198cfc743c367f1bdb582" title="Gets a Boolean indicating if this PersistentBag needs to be recreated in the database. ">NeedsRecreate</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">return</span> !persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#af7811ad5956461644c7f79991b82ed49" title="Is this a one-to-many association?">IsOneToMany</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// For a one-to-many, a &lt;bag&gt; is not really a bag;</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// it is *really* a set, since it can&#39;t contain the</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// same element twice. It could be considered a bug</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment">// in the mapping dtd that &lt;bag&gt; allows &lt;one-to-many&gt;.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// Anyway, here we implement &lt;set&gt; semantics for a</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">// &lt;one-to-many&gt; &lt;bag&gt;!</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a25e74e46090f254310c19dc1c236ec21">  210</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> IEnumerable <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a25e74e46090f254310c19dc1c236ec21" title="Get all the elements that need deleting ">GetDeletes</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister, <span class="keywordtype">bool</span> indexIsFormula)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html">IType</a> elementType = persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#a33cdc395b06756989d606d5d7f5cf858" title="Get the &quot;element&quot; type ">ElementType</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="namespace_n_hibernate.html#a3b5a7882bfc34e812d919e4a806a9438" title="Defines the representation modes available for entities. ">EntityMode</a> entityMode = Session.EntityMode;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            List&lt;object&gt; deletes = <span class="keyword">new</span> List&lt;object&gt;();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            IList sn = (IList) GetSnapshot();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> old <span class="keywordflow">in</span> sn)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">if</span> (bag.Count &gt; i &amp;&amp; elementType.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html#a72caf67ec4d053311e6a47d5ec4b1c06" title="Compare two instances of the class mapped by this type for persistence &quot;equality&quot; - equality of persi...">IsSame</a>(old, bag[i++], entityMode))</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <span class="comment">//a shortcut if its location didn&#39;t change!</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                    <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> newObject <span class="keywordflow">in</span> bag)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                        <span class="keywordflow">if</span> (elementType.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html#a72caf67ec4d053311e6a47d5ec4b1c06" title="Compare two instances of the class mapped by this type for persistence &quot;equality&quot; - equality of persi...">IsSame</a>(old, newObject, entityMode))</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                            found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="keywordflow">if</span> (!found)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    deletes.Add(old);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">return</span> deletes;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a0d400abaac5f00532fdd1bfbcaa12054">  244</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a0d400abaac5f00532fdd1bfbcaa12054" title="Do we need to insert this element? ">NeedsInserting</a>(<span class="keywordtype">object</span> entry, <span class="keywordtype">int</span> i, <a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html">IType</a> elemType)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            IList sn = (IList) GetSnapshot();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <a class="code" href="namespace_n_hibernate.html#a3b5a7882bfc34e812d919e4a806a9438" title="Defines the representation modes available for entities. ">EntityMode</a> entityMode = Session.EntityMode;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">if</span> (sn.Count &gt; i &amp;&amp; elemType.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html#a72caf67ec4d053311e6a47d5ec4b1c06" title="Compare two instances of the class mapped by this type for persistence &quot;equality&quot; - equality of persi...">IsSame</a>(sn[i], entry, entityMode))</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="comment">// a shortcut if its location didn&#39;t change</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="comment">//search for it</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> old <span class="keywordflow">in</span> sn)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">if</span> (elemType.<a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html#aa5abc58e3d65c5042996a41d49ebd242" title="Compare two instances of the class mapped by this type for persistence &quot;equality&quot; - equality of persi...">IsEqual</a>(old, entry, entityMode))</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a9efc406a2e75163dd74ed5b25fdbdc9c">  268</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a9efc406a2e75163dd74ed5b25fdbdc9c" title="Do we need to update this element? ">NeedsUpdating</a>(<span class="keywordtype">object</span> entry, <span class="keywordtype">int</span> i, <a class="code" href="interface_n_hibernate_1_1_type_1_1_i_type.html">IType</a> elemType)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a44d3e8b45475031de6cbabddb0bc0292">  273</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a44d3e8b45475031de6cbabddb0bc0292" title="Get the index of the given collection entry ">GetIndex</a>(<span class="keywordtype">object</span> entry, <span class="keywordtype">int</span> i, <a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotSupportedException(<span class="stringliteral">&quot;Bags don&#39;t have indexes&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a351fd2875fab276d81b07082263e2e62">  278</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a351fd2875fab276d81b07082263e2e62" title="Get the value of the given collection entry ">GetElement</a>(<span class="keywordtype">object</span> entry)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">return</span> entry;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a405b1015e27c8dc74edabb5c2ea1f5c2">  283</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a405b1015e27c8dc74edabb5c2ea1f5c2" title="Get the snapshot value of the given collection entry ">GetSnapshotElement</a>(<span class="keywordtype">object</span> entry, <span class="keywordtype">int</span> i)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            IList sn = (IList) GetSnapshot();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">return</span> sn[i];</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a2813a22cacadf84fc27d57b01692c3a3">  289</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a2813a22cacadf84fc27d57b01692c3a3" title="Does an element exist at this entry in the collection? ">EntryExists</a>(<span class="keywordtype">object</span> entry, <span class="keywordtype">int</span> i)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordflow">return</span> entry != null;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">string</span> ToString()</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            Read();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">return</span> StringHelper.CollectionToString(bag);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">        #region IList Members</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> IsReadOnly</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">object</span> <span class="keyword">this</span>[<span class="keywordtype">int</span> index]</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keyword">get</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                Read();</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="keywordflow">return</span> bag[index];</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            set</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#afb971280d824b61d79106a3346e2ed55a1129c0e4d43f2d121652a7302712cff6">Write</a>();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                bag[index] = value;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> RemoveAt(<span class="keywordtype">int</span> index)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#afb971280d824b61d79106a3346e2ed55a1129c0e4d43f2d121652a7302712cff6">Write</a>();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            bag.RemoveAt(index);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#a6d7e7fee72a028178282214d595a45f8aa458be0f08b7e4ff3c0f633c100176c0">Insert</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#afb971280d824b61d79106a3346e2ed55a1129c0e4d43f2d121652a7302712cff6">Write</a>();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            bag.Insert(index, value);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> Remove(<span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            Initialize(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">// NH: Different implementation: we use the count to know if the value was removed (better performance)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordtype">int</span> contained = bag.Count;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            bag.Remove(value);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (contained != bag.Count)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#a0d9f8647277b69c86183db3f8f4e90cca99feffc57dae9a01652065178fae5b19">Dirty</a>();</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Contains(<span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordtype">bool</span>? exists = ReadElementExistence(value);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">return</span> !exists.HasValue ? bag.Contains(value) : exists.Value;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> Clear()</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">if</span> (ClearQueueEnabled)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                QueueOperation(<span class="keyword">new</span> ClearDelayedOperation(<span class="keyword">this</span>));</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                Initialize(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keywordflow">if</span> (!(bag.Count == 0))</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    bag.Clear();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#a0d9f8647277b69c86183db3f8f4e90cca99feffc57dae9a01652065178fae5b19">Dirty</a>();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">int</span> IndexOf(<span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            Read();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordflow">return</span> bag.IndexOf(value);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">int</span> Add(<span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">if</span> (!IsOperationQueueEnabled)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <a class="code" href="namespace_n_hibernate_1_1_cfg_1_1_mapping_schema.html#afb971280d824b61d79106a3346e2ed55a1129c0e4d43f2d121652a7302712cff6">Write</a>();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keywordflow">return</span> bag.Add(value);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                QueueOperation(<span class="keyword">new</span> SimpleAddDelayedOperation(<span class="keyword">this</span>, value));</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <span class="comment">//TODO: take a look at this - I don&#39;t like it because it changes the </span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="comment">// meaning of Add - instead of returning the index it was added at </span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="comment">// returns a &quot;fake&quot; index - not consistent with IList interface...</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> IsFixedSize</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor">        #region ICollection Members</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> IsSynchronized</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">int</span> Count</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> ReadSize() ? CachedSize : bag.Count; }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> CopyTo(Array array, <span class="keywordtype">int</span> index)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = index; i &lt; Count; i++)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                array.SetValue(<span class="keyword">this</span>[i], i);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">object</span> SyncRoot</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">this</span>; }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="preprocessor">        #region IEnumerable Members</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keyword">public</span> IEnumerator GetEnumerator()</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            Read();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">return</span> bag.GetEnumerator();</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00436"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a0e66fe0f094772a472afbdd61f5832a0">  436</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html#a0e66fe0f094772a472afbdd61f5832a0" title="Called after initializing from cache ">AfterInitialize</a>(<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html" title="A strategy for persisting a collection role. ">ICollectionPersister</a> persister)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="comment">// NH Different behavior : NH-739</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="comment">// would be nice to prevent this overhead but the operation is managed where the ICollectionPersister is not available</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordtype">bool</span> result;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="keywordflow">if</span> (persister.<a class="code" href="interface_n_hibernate_1_1_persister_1_1_collection_1_1_i_collection_persister.html#af7811ad5956461644c7f79991b82ed49" title="Is this a one-to-many association?">IsOneToMany</a> &amp;&amp; HasQueuedOperations)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <span class="keywordtype">int</span> additionStartFrom = bag.Count;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                IList additionQueue = <span class="keyword">new</span> List&lt;object&gt;(additionStartFrom);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> o <span class="keywordflow">in</span> QueuedAdditionIterator)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    <span class="keywordflow">if</span> (o != null)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bag.Count; i++)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                            <span class="comment">// we are using ReferenceEquals to be sure that is exactly the same queued instance </span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                            <span class="keywordflow">if</span> (ReferenceEquals(o, bag[i]))</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                            {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                                additionQueue.Add(o);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                            }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                        }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                result = base.AfterInitialize(persister);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="keywordflow">if</span>(!result)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    <span class="comment">// removing duplicated additions</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> o <span class="keywordflow">in</span> additionQueue)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = additionStartFrom; i &lt; bag.Count; i++)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                            <span class="keywordflow">if</span> (ReferenceEquals(o, bag[i]))</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                            {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                bag.RemoveAt(i);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                result = base.AfterInitialize(persister);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">        #region DelayedOperations</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00488"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_clear_delayed_operation.html">  488</a></span>&#160;        <span class="keyword">protected</span> sealed <span class="keyword">class </span><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_clear_delayed_operation.html">ClearDelayedOperation</a> : <a class="code" href="interface_n_hibernate_1_1_collection_1_1_abstract_persistent_collection_1_1_i_delayed_operation.html">IDelayedOperation</a></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keyword">private</span> readonly <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a> enclosingInstance;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keyword">public</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_clear_delayed_operation.html">ClearDelayedOperation</a>(<a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a> enclosingInstance)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                this.enclosingInstance = enclosingInstance;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">object</span> AddedInstance</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keyword">get</span> { <span class="keywordflow">return</span> null; }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">object</span> Orphan</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="keyword">get</span> { <span class="keywordflow">throw</span> <span class="keyword">new</span> NotSupportedException(<span class="stringliteral">&quot;queued clear cannot be used with orphan delete&quot;</span>); }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">void</span> Operate()</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                enclosingInstance.bag.Clear();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno"><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_simple_add_delayed_operation.html">  513</a></span>&#160;        <span class="keyword">protected</span> sealed <span class="keyword">class </span><a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_simple_add_delayed_operation.html">SimpleAddDelayedOperation</a> : <a class="code" href="interface_n_hibernate_1_1_collection_1_1_abstract_persistent_collection_1_1_i_delayed_operation.html">IDelayedOperation</a></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <span class="keyword">private</span> readonly <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a> enclosingInstance;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keyword">private</span> readonly <span class="keywordtype">object</span> value;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <span class="keyword">public</span> <a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag_1_1_simple_add_delayed_operation.html">SimpleAddDelayedOperation</a>(<a class="code" href="class_n_hibernate_1_1_collection_1_1_persistent_bag.html" title="An unordered, unkeyed collection that can contain the same element multiple times. The .NET collections API has no Bag class. Most developers seem to use ILists to represent bag semantics, so NHibernate follows this practice. ">PersistentBag</a> enclosingInstance, <span class="keywordtype">object</span> value)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                this.enclosingInstance = enclosingInstance;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                this.value = value;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">object</span> AddedInstance</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <span class="keyword">get</span> { <span class="keywordflow">return</span> value; }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">object</span> Orphan</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="keyword">get</span> { <span class="keywordflow">return</span> null; }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">void</span> Operate()</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                enclosingInstance.bag.Add(value);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8ceffd4ee35c3518d4e8bdc7e638efe8.html">Users</a></li><li class="navelem"><a class="el" href="dir_9f2bc69ad3850ea0b1eb7e8957b592d3.html">michael</a></li><li class="navelem"><a class="el" href="dir_f68266c935e6601a6b354a7a3fe8cebe.html">Development</a></li><li class="navelem"><a class="el" href="dir_7ad34b7b988357f7795f42187a275fa7.html">HSA.InfoSys</a></li><li class="navelem"><a class="el" href="dir_76d1b2293a59a3f7e99194d6baf2a3b5.html">3rdparty</a></li><li class="navelem"><a class="el" href="dir_d9bcc14e82931392e08de330211ee0a7.html">nhibernate-core</a></li><li class="navelem"><a class="el" href="dir_5b8fd4d1be83e80e12f265252ef3db1e.html">src</a></li><li class="navelem"><a class="el" href="dir_c526d93b00606470303d366d91616a48.html">NHibernate</a></li><li class="navelem"><a class="el" href="dir_61fa0610826cf0951458cfb4ef5a3ae2.html">Collection</a></li><li class="navelem"><b>PersistentBag.cs</b></li>
    <li class="footer">Generated on Fri Jul 5 2013 02:11:58 for HSA.InfoSys by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
